<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Status</title>

<style>

*{
  box-sizing:border-box;
  font-family:Segoe UI, sans-serif;
}

body{
  margin:0;
  min-height:100vh;
  background: linear-gradient(
    180deg,
    #fff4ec 0%,
    #f3f0ff 50%,
    #eef5ff 100%
  );
  display:flex;
  justify-content:center;
  align-items:center;
}

/* MAIN CONTAINER */

.container{
  width:90%;
  max-width:750px;
  display:flex;
  flex-direction:column;
  gap:22px;
}

/* TITLE */

.status-title{
  text-align:center;
  font-size:30px;
  font-weight:bold;

}

/* SERVING CARD */

.serving-card{
  background:white;
  padding:28px;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
  text-align:center;
}

.serving-user{
  font-size:32px;
  font-weight:700;
  color:#4facfe;
  margin:10px 0 18px;
}

.serving-info{
  display:flex;
  justify-content:space-around;
  font-size:15px;
  color:#555;
  flex-wrap:wrap;
  gap:10px;
}

.serving-info div{
  background:#f6f9ff;
  padding:10px 14px;
  border-radius:12px;
}

/* WAITING CARD */

.waiting-card{
  background:white;
  padding:24px;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.waiting-card h3{
  margin-bottom:14px;
  font-size:22px;
  text-align: center;
}

/* QUEUE LIST */

#queue{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.queue-row{
  background:#f6f9ff;
  padding:12px 16px;
  border-radius:12px;
  font-size:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.queue-left{
  font-weight:600;
}

.queue-time{
  color:#555;
  font-size:14px;
}

/* EMPTY */

.empty{
  color:#888;
  font-style:italic;
}

@media(max-width:500px){
  .serving-user{
    font-size:26px;
  }

  .serving-info{
    flex-direction:column;
  }
}

</style>
</head>

<body>

<div class="container">

  <div class="status-title">User Current Status</div>

  <!-- SERVING CARD -->

  <div class="serving-card">

    <div>Now Serving</div>

    <div id="nowServing" class="serving-user">---</div>

    <div class="serving-info">
      <div>Start: <span id="startTime">--</span></div>
      <div>End: <span id="endTime">--</span></div>
      <div>Total: <span id="totalTime">--</span></div>
    </div>

  </div>

  <!-- WAITING LIST -->

  <div class="waiting-card">
    <h3>Waiting List</h3>
    <div id="queue"></div>
  </div>

</div>

<!-- SOCKET -->

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const socket = io("http://localhost:5000");
</script>
<script>

let startTimestamp = null;
let timerInterval = null;

// Format time nicely
function formatTime(date){
  return date.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
}

// Called when new user starts serving
function startServiceTimer(){

  startTimestamp = new Date();

  document.getElementById("startTime").innerText = formatTime(startTimestamp);
  document.getElementById("endTime").innerText = "--";

  if(timerInterval) clearInterval(timerInterval);

  timerInterval = setInterval(()=>{

    const now = new Date();
    const elapsed = Math.floor((now - startTimestamp)/1000);

    const mins = Math.floor(elapsed/60);
    const secs = elapsed % 60;

    document.getElementById("totalTime").innerText = `${mins}m ${secs}s`;

  },1000);
}

// Called when admin finishes service
function stopServiceTimer(){

  if(!startTimestamp) return;

  const endTimestamp = new Date();

  document.getElementById("endTime").innerText = formatTime(endTimestamp);

  clearInterval(timerInterval);
}

</script>


<script src="js/socket.js"></script>
<script src="js/userstatus.js"></script>

</body>
</html>
